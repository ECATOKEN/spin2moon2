<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPIN2MOON - Spin & Win SOL</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #0a001a, #1a0033);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 30px; background: rgba(0,0,0,0.8); border-bottom: 2px solid #8a2be2;
            position: fixed; top: 0; width: 100%; z-index: 1000;
        }
        .logo { font-size: 1.8em; background: linear-gradient(45deg, #ff00ff, #00ffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        #wallet-btn { padding: 10px 20px; background: #8a2be2; border: none; border-radius: 30px; color: white; font-weight: bold; cursor: pointer; }
        #wallet-btn.connected { background: #00ff00; color: black; }
        .container { margin-top: 90px; padding: 20px; text-align: center; max-width: 1000px; margin-left: auto; margin-right: auto; }
        h1 { font-size: 3em; margin: 20px 0; color: #ffd700; text-shadow: 0 0 20px #ff00ff; }
        .info { font-size: 1.2em; margin: 15px 0; color: #ccc; }
        #balance { font-size: 1.6em; color: #00ff00; margin: 20px 0; font-weight: bold; }
        #spin-btn { padding: 18px 40px; font-size: 1.4em; background: linear-gradient(45deg, #ff00ff, #8a2be2); border: none; border-radius: 50px; color: white; cursor: pointer; margin: 20px; box-shadow: 0 0 30px rgba(255,0,255,0.4); }
        #spin-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        #wheel-container { width: 360px; height: 360px; margin: 30px auto; position: relative; }
        #wheel-canvas { width: 100%; height: 100%; }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 40px solid #ffd700; z-index: 10; }
        #result { font-size: 2.2em; margin: 25px 0; min-height: 60px; font-weight: bold; }
        #withdraw { display: none; background: #00ff00; color: black; padding: 15px 35px; border: none; border-radius: 50px; font-size: 1.2em; font-weight: bold; cursor: pointer; }
        .leaderboard {
            position: fixed; right: 20px; top: 100px; width: 300px; background: rgba(0,0,0,0.8); border: 2px solid #8a2be2; border-radius: 15px; padding: 15px; z-index: 500;
        }
        .leaderboard h3 { color: #ffd700; margin-bottom: 10px; text-align: center; }
        .leaderboard ul { list-style: none; max-height: 400px; overflow-y: auto; }
        .leaderboard li { padding: 8px; border-bottom: 1px dashed #444; color: #0f0; font-size: 0.9em; }
        .confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; display: none; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">SPIN2MOON</div>
        <button id="wallet-btn">CONNECT PHANTOM</button>
    </div>

    <div class="container">
        <h1>SPIN & WIN SOL</h1>
        <p class="info"><b>Her 100$ $SPIN = 1 Spin</b><br>0.8 SOL Jackpot! 3 SOL = Ã‡ek</p>
        
        <div id="balance">Bakiye: 0 SOL</div>
        <button id="spin-btn" disabled>SPIN Ã‡EVÄ°R</button>
        
        <div id="wheel-container">
            <canvas id="wheel-canvas"></canvas>
            <div class="pointer"></div>
        </div>
        
        <div id="result"></div>
        <button id="withdraw">WITHDRAW (3 SOL)</button>
    </div>

    <div class="leaderboard">
        <h3>RECENT WINNERS</h3>
        <ul id="winner-list"></ul>
    </div>

    <canvas id="confetti" class="confetti"></canvas>

    <script>
        // === Phantom Wallet Connect (Mobil + PC) ===
        const walletBtn = document.getElementById('wallet-btn');
        const balanceEl = document.getElementById('balance');
        const spinBtn = document.getElementById('spin-btn');
        const resultEl = document.getElementById('result');
        const withdrawBtn = document.getElementById('withdraw');
        const winnerList = document.getElementById('winner-list');

        let publicKey = null;
        let balance = 0;
        let spinning = false;

        walletBtn.addEventListener('click', async () => {
            if (publicKey) return;

            // Mobil & PC iÃ§in gÃ¼venli kontrol
            if (typeof window.solana !== 'undefined' && window.solana?.isPhantom) {
                try {
                    const resp = await window.solana.connect();
                    publicKey = resp.publicKey.toString();
                    walletBtn.innerHTML = `${publicKey.slice(0,4)}...${publicKey.slice(-4)}`;
                    walletBtn.classList.add('connected');
                    spinBtn.disabled = false;
                    loadBalance();
                } catch (err) {
                    alert("BaÄŸlantÄ± reddedildi!");
                }
            } else {
                // Mobil fallback: Phantom app aÃ§
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                if (isMobile) {
                    window.location.href = 'https://phantom.app/ul/browse?ref=' + encodeURIComponent(window.location.href);
                } else {
                    alert("LÃ¼tfen Phantom Wallet eklentisini tarayÄ±cÄ±ya yÃ¼kleyin!");
                }
            }
        });

        // === Balance ===
        function loadBalance() {
            if (publicKey) {
                const key = `spin2moon_${publicKey}`;
                balance = parseFloat(localStorage.getItem(key)) || 0;
                updateBalance();
            }
        }
        function saveBalance() {
            if (publicKey) {
                const key = `spin2moon_${publicKey}`;
                localStorage.setItem(key, balance.toString());
            }
        }
        function updateBalance() {
            balanceEl.innerHTML = `Bakiye: ${balance.toFixed(2)} SOL`;
            if (balance >= 3) withdrawBtn.style.display = 'block';
        }

        // === EÅžÄ°T Ã‡ARK (5 dilim, her biri 72Â°) ===
        const ctx = document.getElementById('wheel-canvas').getContext('2d');
        const segments = [
            { text: 'TRY AGAIN', color: '#1a1a1a' },
            { text: '0.2 SOL', color: '#00ff00' },
            { text: '0.4 SOL', color: '#ffff00' },
            { text: '0.6 SOL', color: '#ff9900' },
            { text: '0.8 SOL', color: '#ff00ff' }
        ];
        const chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [1,1,1,1,1],  // GÃ¶rsel eÅŸitlik
                    backgroundColor: segments.map(s => s.color),
                    borderWidth: 3,
                    borderColor: '#000'
                }]
            },
            options: {
                cutout: '0%',
                rotation: -90,
                plugins: { legend: { display: false } },
                animation: { animateRotate: true }
            },
            plugins: [{
                afterDraw: (chart) => {
                    const ctx = chart.ctx;
                    const centerX = chart.width / 2;
                    const centerY = chart.height / 2;
                    const radius = chart.outerRadius * 0.65;
                    let angle = chart.options.rotation * Math.PI / 180;

                    segments.forEach(seg => {
                        const mid = angle + Math.PI / 5;
                        const x = centerX + Math.cos(mid) * radius;
                        const y = centerY + Math.sin(mid) * radius;

                        ctx.save();
                        ctx.translate(x, y);
                        ctx.rotate(mid + Math.PI / 2);
                        ctx.font = 'bold 18px Orbitron';
                        ctx.fillStyle = '#ffffff';
                        ctx.textAlign = 'center';
                        ctx.fillText(seg.text, 0, 0);
                        ctx.restore();

                        angle += 2 * Math.PI / 5;
                    });
                }
            }]
        });

        // === Spin ===
        spinBtn.addEventListener('click', () => {
            if (spinning || !publicKey) return;
            spinning = true;
            spinBtn.disabled = true;
            spinBtn.innerText = 'Ã‡EVÄ°RÄ°LÄ°YOR...';
            resultEl.innerHTML = '';

            const fullSpins = 5 + Math.random() * 3;
            const finalRotation = fullSpins * 360 + Math.random() * 360;
            chart.options.rotation = finalRotation % 360;
            chart.update();

            setTimeout(() => {
                const rand = Math.random();
                let prize = 0;
                let msg = 'TRY AGAIN ðŸ˜­';
                let color = '#ff0000';

                if (rand < 0.60) prize = 0;
                else if (rand < 0.85) { prize = 0.2; msg = '0.2 SOL!'; color = '#00ff00'; }
                else if (rand < 0.95) { prize = 0.4; msg = '0.4 SOL!'; color = '#ffff00'; }
                else if (rand < 0.99) { prize = 0.6; msg = '0.6 SOL!'; color = '#ff9900'; }
                else { prize = 0.8; msg = 'JACKPOT 0.8 SOL!'; color = '#ff00ff'; showConfetti(); }

                balance += prize;
                saveBalance();
                resultEl.innerHTML = `<span style="color: ${color};">${msg}</span>`;
                updateBalance();
                addWinner(publicKey.slice(0,6) + '...', prize);
                spinning = false;
                spinBtn.disabled = false;
                spinBtn.innerText = 'SPIN Ã‡EVÄ°R';
            }, 3200);
        });

        // === Withdraw ===
        withdrawBtn.addEventListener('click', () => {
            withdrawBtn.innerText = 'Processing...';
            setTimeout(() => {
                alert('TX Failed! Try later.');
                withdrawBtn.innerText = 'WITHDRAW (3 SOL)';
            }, 1500);
        });

        // === Fake Winners ===
        const fakeWallets = ['4xMoon...', 'DegenX...', 'SolRich...', 'PumpGod...', 'HodlKing...'];
        function addWinner(wallet, amount) {
            const li = document.createElement('li');
            li.innerHTML = `<b>${wallet}</b> won <span style="color:#00ff00">${amount} SOL</span>`;
            winnerList.insertBefore(li, winnerList.firstChild);
            if (winnerList.children.length > 8) winnerList.removeChild(winnerList.lastChild);
        }
        setInterval(() => {
            if (Math.random() < 0.3) {
                const w = fakeWallets[Math.floor(Math.random()*5)];
                const p = [0.2, 0.4, 0.6, 0.8][Math.floor(Math.random()*4)];
                addWinner(w, p);
            }
        }, 15000);

        // === Confetti ===
        function showConfetti() {
            const canvas = document.getElementById('confetti');
            canvas.style.display = 'block';
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            for (let i = 0; i < 150; i++) {
                setTimeout(() => {
                    ctx.fillStyle = ['#ff00ff', '#00ffff', '#ffd700'][Math.floor(Math.random()*3)];
                    ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 8, 8);
                }, i * 30);
            }
            setTimeout(() => canvas.style.display = 'none', 4000);
        }
    </script>
</body>
</html>